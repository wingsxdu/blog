---
title: 密码保护：前台接口定义
author: beihai
type: post
date: 2019-05-21T10:01:49+00:00
url: /?p=1188
hestia_layout_select:
  - sidebar-right
  - sidebar-right
categories:
  - Golang

---
##### 前言说明

url路径：<code class="http">https://star.wingsxdu.com</code>
  
如路由为：/login，完整的 uri 为：<code class="http">https://star.wingsxdu.com/login</code>

<pre class="pure-highlightjs"><code class="null">String 返回值均已改成JSON。</code></pre>

###### **专有名词**

  * <code class="null">Content-Type:application/form-data</code>与<code class="null">Content-Type:application/x-www-form-urlencoded</code>后台均可解析，二选一，文档统一用<code class="null">form-data</code>代替；

<pre class="pure-highlightjs"><code class="null">uid//用户唯一标识id，长度最大为20
password//用户密码
username//用户名，长度最大为25
code//微信登录获取的临时
code itemname//商品名称
description//描述
tag//标签
value//商品价格
file//用户选择的图片
Itemhash//商品hash，唯一值 Ext//商品的扩展名，如：".docx"、".jpg"
Transactionhash//商品记录在区块链上得到的记录id
from//买家uid
to//卖家即商品所有者的uid
txId//订单号
Mold//交易类型，默认值为0，增值服务为1（type为golang 关键字，无法使用）</code></pre>

###### **已知Bug**

**Web 端：**

  * 若 get 方法存在 header，无法执行跨域请求，请在header 内添加字段<code class="null">Content-Type:application/form-data</code>
  * 

##### 注册登录组

注册

<pre class="pure-highlightjs"><code class="null">路由：/register
方式：post
header:{
    Content-Type:application/form-data
}
body:{
    uid:
    password:
    username:
}
返回值：{
    成功：return c.JSONPretty(http.StatusOK, &lt;span>{&lt;/span>&lt;span class="hljs-keyword">balance&lt;/span>&lt;span>:&lt;/span>注册成功,账户资金为：} )
    失败：return c.JSONPretty(http.StatusInternalServerError, &lt;span>{&lt;/span>&lt;span class="hljs-keyword">result&lt;/span>&lt;span>:服务器可能出现内部错误} &lt;/span>)
    用户已存在：return c.JSONPretty(http.StatusOK, &lt;span>{&lt;/span>&lt;span class="hljs-keyword">result&lt;/span>&lt;span>:&lt;/span>该用户已存在，请重新注册} )
    //解释：c.后面为返回值类型，如c.String返回值为String类型，c.JSON为JSON类型；
    //     http.StatusOK为返回的code,如200、404等，不用管；最后为返回值
}</code></pre>

登录：平台方

<pre class="pure-highlightjs"><code class="null">路由：/login
方式：post
header:{
    Content-Type:application/form-data
}
body:{
    uid:
    password:
}
返回值{
成功：return c.JSONPretty(http.StatusOK, {token: t})//token值保存
密码错误：return c.JSONPretty(http.StatusOK, &lt;span>{&lt;/span>&lt;span class="hljs-keyword">result&lt;/span>&lt;span>:&lt;/span>用户名或密码错误} )
错误：return c.JSONPretty(http.StatusInternalServerError, &lt;span>{&lt;/span>&lt;span class="hljs-keyword">result&lt;/span>&lt;span>:&lt;/span>服务器可能出现内部错误} )
}</code></pre>

登录：微信

<pre class="pure-highlightjs"><code class="null">路由：/login/wechat
方式：post
header:{
    Content-Type:application/form-data
}
body:{
    code:
}
返回值{
成功：return c.JSONPretty(http.StatusOK, {token: t,})//token值保存
错误：return c.JSONPretty(http.StatusInternalServerError, &lt;span>{&lt;/span>&lt;span class="hljs-keyword">result&lt;/span>&lt;span>:&lt;/span>服务器可能出现内部错误} )
}</code></pre>

##### 用户组

获取用户信息
  
更改用户昵称
  
查询账户余额

<pre class="pure-highlightjs"><code class="null">路由：/user/balance
方式：get
header:{
    Authorization:Bearer +登录获取的token值//注意Bearer与token值之间有一个空格
}
返回值{
成功：return c.JSONPretty(http.StatusOK, &lt;span>{&lt;/span>&lt;span class="hljs-keyword">balance&lt;/span>&lt;span>:value} &lt;/span>)
失败：return c.JSONPretty(http.StatusOK, &lt;span>{&lt;/span>&lt;span class="hljs-keyword">result&lt;/span>&lt;span>:服务器可能出现内部错误}&lt;/span>&lt;span> &lt;/span>)
}</code></pre>

##### 搜索组

搜索

<pre class="pure-highlightjs"><code class="null">路由：/search/:kw //示例：search/用户输入的搜索词
方式：get
返回值{
成功：return c.JSONPretty(http.StatusOK, JSONArray )
无结果：return c.JSONPretty(http.StatusOK, &lt;span>{&lt;/span>&lt;span class="hljs-keyword">result&lt;/span>&lt;span>:&lt;/span>无查询结果} )
}
&lt;span>数组字段：
[{
    Itemhash
    Itemname
    Description
    Tag
    Uid
    Value
    Ext
    Transactionhash
}]&lt;/span></code></pre>

##### 缩略图组

获取缩略图信息

<pre class="pure-highlightjs"><code class="null">路由：/thumbnail/list/:kw(暂用"测试数据"与"背景"两个字段)
方式：get
返回值{
成功：return c.JSONPretty(http.StatusOK, JSONArray,"")
失败：return c.JSON(http.StatusOK,&lt;span> &lt;/span>&lt;span>{&lt;/span>&lt;span class="hljs-keyword">result&lt;/span>&lt;span>:&lt;/span>无查询结果} )
}
&lt;span>数组字段：
[{
    Itemhash
    Uid
    Ext
}]&lt;/span></code></pre>

加载缩略图
  
使用：解析上面获取的 json 数组，遍历加载数组内的 json 对象获取缩略图。

<pre class="pure-highlightjs"><code class="null">路由：/thumbnail?uid=uid&itemhash=itemhash&ext=ext
方式：get
返回值{
成功：return c.Inline(缩略图)//在浏览器加载显示
}</code></pre>

##### 数据上传下载组

数据上传

<pre class="pure-highlightjs"><code class="null">路由：/restricted/upload
方式：post
header:{
    Content-Type:application/form-data
    Authorization:Bearer +登录获取的token值//注意Bearer与token值之间有一个空格
}
body:{
    itemname://商品名称
    description://描述
    tag://标签
    value://
    file://用户选择的图片
}
返回值{
成功：return c.JSONPretty(http.StatusCreated,&lt;span> &lt;/span>&lt;span>{&lt;/span>&lt;span class="hljs-keyword">result&lt;/span>&lt;span>:&lt;/span>数据上传成功,唯一标识id为：} )
已上传：return c.JSONPretty(http.StatusOK,&lt;span> &lt;/span>&lt;span>{&lt;/span>&lt;span class="hljs-keyword">result&lt;/span>&lt;span>:&lt;/span>该数据已被上传，是否进行数据确权？} )
错误：return c.JSONPretty(http.StatusNotFound,&lt;span> &lt;/span>&lt;span>{&lt;/span>&lt;span class="hljs-keyword">result&lt;/span>&lt;span>:&lt;/span>文件上传失败，请检查网络或重新上传} )
           return c.JSONPretty(http.StatusInternalServerError,&lt;span> &lt;/span>&lt;span>{&lt;/span>&lt;span class="hljs-keyword">result&lt;/span>&lt;span>:&lt;/span>服务器可能出现内部错误} )
}</code></pre>

下载原图

<pre class="pure-highlightjs"><code class="null">路由：/restricted/download
方式：post
header:{
    Content-Type:application/form-data
    Authorization:Bearer +登录获取的token值//注意Bearer与token值之间有一个空格
}
body:{
    uid://商品所有者的用户id
    itemhash:
    ext:
}
返回值{
成功：return c.File(原图)//浏览器下载文件并保存
}</code></pre>

##### 商品组

获取商品详情

<pre class="pure-highlightjs"><code class="null">路由：/restricted/item/get/:ih
方式：get
header:{
    Authorization:Bearer +登录获取的token值//注意Bearer与token值之间有一个空格
}
返回值{
成功： return c.JSONPretty(http.StatusOK, JSONObject)
无查询结果：return c.JSONPretty(http.StatusOK,&lt;span> &lt;/span>&lt;span>{&lt;/span>&lt;span class="hljs-keyword">result&lt;/span>&lt;span>:&lt;/span>无查询结果} )
}
Json 对象字段
&lt;span>{
    Itemhash
    Itemname
    Description
    Tag
    Uid
    Value
    Ext
    Transactionhash
}&lt;/span></code></pre>

确认商品是否存在

<pre class="pure-highlightjs"><code class="null">路由：/restricted/item/has/:ih
方式：get
header:{
    Authorization:Bearer +登录获取的token值//注意Bearer与token值之间有一个空格
}
返回值{
成功： return c.JSONPretty(http.StatusOK,&lt;span> &lt;/span>&lt;span>{&lt;/span>&lt;span class="hljs-keyword">result&lt;/span>&lt;span>:&lt;/span>该数据确认存在} )
无查询结果：return c.JSONPretty(http.StatusOK,&lt;span> &lt;/span>&lt;span>{&lt;/span>&lt;span class="hljs-keyword">result&lt;/span>&lt;span>:&lt;/span>无查询结果} )
}</code></pre>

删除商品（下架）

<pre class="pure-highlightjs"><code class="null">路由：/restricted/item/delete/:ih
方式：get
header:{
    Authorization:Bearer +登录获取的token值//注意Bearer与token值之间有一个空格
}
返回值{
成功：return c.JSONPretty(http.StatusOK,&lt;span> &lt;/span>&lt;span>{&lt;/span>&lt;span class="hljs-keyword">result&lt;/span>&lt;span>:&lt;/span>数据删除成功} )
失败：return c.JSONPretty(http.StatusOK,&lt;span> &lt;/span>&lt;span>{&lt;/span>&lt;span class="hljs-keyword">result&lt;/span>&lt;span>:&lt;/span>删除失败，确认数据哈希值是否正确} )
操作账户与所有者不匹配：return c.JSONPretty(http.StatusOK,&lt;span> &lt;/span>&lt;span>{&lt;/span>&lt;span class="hljs-keyword">result&lt;/span>&lt;span>:&lt;/span>您不是该商品的所有者} )
}</code></pre>

更新商品信息

<pre class="pure-highlightjs"><code class="null">路由：/restricted/item/update
方式：post
header:{
    Content-Type:multipart/form-data
    Authorization:Bearer +登录获取的token值//注意Bearer与token值之间有一个空格
}
body:{
    itemhash://必填字段
    itemname:
    value:
    description:
    tag:
}
返回值{
成功：return c.JSONPretty(http.StatusOK, {result:更新成功},"")
失败：return c.JSONPretty(http.StatusOK, {result:更新失败，请稍后重试},"")
}</code></pre>

##### 交易组

交易

<pre class="pure-highlightjs"><code class="null">路由：/restricted/trade
方式：post
header:{
    Content-Type:multipart/form-data
    Authorization:Bearer +登录获取的token值//注意Bearer与token值之间有一个空格
}
body:{
    to://卖家即商品所有者的uid
    value://价格
    itemhash:
    mold://交易类型，默认值为0
}
返回值{
成功：return c.JSONPretty(http.StatusOK, &lt;span>{TxId&lt;/span>&lt;span>:订单号} &lt;/span>)
失败：return c.JSONPretty(http.StatusOK,&lt;span> &lt;/span>&lt;span>{&lt;/span>&lt;span class="hljs-keyword">result&lt;/span>&lt;span>:交易失败} &lt;/span>)
}</code></pre>

退款

<pre class="pure-highlightjs"><code class="null">路由：/restricted/trade/refund
方式：post
header:{
    Content-Type:multipart/form-data
    Authorization:Bearer +登录获取的token值//注意Bearer与token值之间有一个空格
}
body:{
    from://买家uid
    to://卖家即商品所有者的uid
    txId://订单号
}
返回值{
成功：return c.JSONPretty(http.StatusOK, {result:退款成功} )
失败：return c.JSONPretty(http.StatusOK, {result:退款失败，请检查订单号} )
}</code></pre>

查询订单信息

<pre class="pure-highlightjs"><code class="null">路由：/restricted/trade/txinfo
方式：post
header:{
    Content-Type:multipart/form-data
    Authorization:Bearer +登录获取的token值//注意Bearer与token值之间有一个空格
}
body:{
    txId://订单号
}
返回值{
成功：return c.JSONPretty(http.StatusOK, {result:交易信息详情} )
}</code></pre>

买家订单查询

<pre class="pure-highlightjs"><code class="null">路由：/restricted/trade/fromlist
方式：get
header:{
    Authorization:Bearer +登录获取的token值//注意Bearer与token值之间有一个空格
}
返回值{
成功：return c.JSONPretty(http.StatusOK, JsonArray)
失败：return c.JSONPretty(http.StatusOK, {result:无查询结果} )
}
数组字段：
[{
    From
    To
    Value
    ItemHash
    Mold
    TxId
}]</code></pre>

卖价家订单查询

<pre class="pure-highlightjs"><code class="null">路由：/restricted/trade/tolist
其他同上</code></pre>

##### 应付组

数据信息上链

<pre class="pure-highlightjs"><code class="null">路由：/restricted/watermark/add
方式：post
header:{
    Content-Type:application/form-data
    Authorization:Bearer +登录获取的token值//注意Bearer与token值之间有一个空格
}
body:{
    itemhash//商品hash
    message//水印信息
}
返回值{
成功：return c.JSONPretty(http.StatusCreated, JsonArray )
数组字段：
[{
has:bool
TxId
}]</code></pre>

根据TxId查询

<pre class="pure-highlightjs"><code class="null">路由：/restricted/watermark/get
方式：post
header:{
    Content-Type:application/form-data
    Authorization:Bearer +登录获取的token值//注意Bearer与token值之间有一个空格
}
body:{
    TxId
}
返回值{
成功：return c.JSONPretty(http.StatusCreated, JsonArray )
数组字段：
[{
uid
itemhash
message
time
}]</code></pre>

##### WSL

上传图片

<pre class="pure-highlightjs"><code class="null">路由：/upload
方式：post
header:{
    Content-Type:application/form-data
}
body:{
    file://选择的图片
}
返回值{
成功：return c.JSONPretty(http.StatusCreated, {result:success} )
错误：return c.JSONPretty(http.StatusNotFound, {result:文件上传失败，请检查网络或重新上传} )
           return c.JSONPretty(http.StatusInternalServerError, {result:服务器可能出现内部错误} )
}</code></pre>

编码

<pre class="pure-highlightjs"><code class="null">路由：/decode
方式：post
header:{
    Content-Type:application/form-data
}
body:{
    filename://商品名称
    txid//交易hash
}
返回值{
成功：return c.File({temp.png} )
错误：return c.JSONPretty(http.StatusNotFound, {result:error()} )
</code></pre>

解码

<pre class="pure-highlightjs"><code class="null">路由：/decode
方式：post
header:{
    Content-Type:application/form-data
}
body:{
    filename://商品名称
}
返回值{
成功：return c.JSON(http.StatusOK, {result:图片解码得到的信息})
错误：return c.JSONPretty(http.StatusNotFound, {result:error()} )</code></pre>

&nbsp;

&nbsp;