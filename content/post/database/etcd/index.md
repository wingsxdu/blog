---
title: 分布式键值存储 etcd 原理与实现 · Analyze
author: beihai
summary: "<blockquote><p>CHAR 与 VARCHAR 是 MySQL 中常用的存储字符串的数据类型，在官方文档的介绍中 CHAR 类型的可定义最大长度为 255，而 VARCHAR 类型的最大长度为 65535，然而经过操作发现 VARCHAR 实际可创建的最大“长度”是一个不定值，这篇文章将会对这个问题进行分析。</p></blockquote>"
tags: [
  	"etcd",
  	"Raft",
]
categories: [
	"Analyze",
  	"etcd",
  	"Raft",
	"数据库",
	"分布式",
]
date: 2020-05-26T12:05:03+08:00
draft: true
---

> etcd 是由 CoreOS 发起的开源项目，旨在构建一个高可用的分布式键值存储系统。etcd 可以用于存储关键数据和实现分布式调度，在现代化的集群运行中起到关键性的作用。





## MVCC

在数据库领域，并发控制是一个很具有挑战性的决策问题。常见的并发控制方式包括悲观锁、乐观锁和多版本并发控制。

#### 悲观锁与乐观锁

悲观锁可以阻止一个事务以影响其他用户的方式来修改数据。如果一个事务执行的操作对某行数据应用了锁，那么只有在这个事务将锁释放之后，其他事务才能够执行与该锁冲突的操作。悲观并发控制主要用于数据争用激烈的环境，以及发生并发冲突时使用锁保护
数据的成本要低于回滚事务的成本的环境中。

乐观锁假设多用户并发的事务在处理时彼此之间不会互相影响，各事务能够在不产生锁的情况下处理各自影响的那部分数据。在提交数据更新之前，每个事务都会先检查在该事务读取数据之后，有没有其他事务又修改了该数据。 如果其他事务对数据进行了修改，那么正在提交的事务会进行回滚。乐观锁多用于数据争用不大、冲突较少的环境，偶尔回滚事务的成本要比读取数据时锁定数据的成本低很多，在这种情况下乐观锁可以获得比其他并发控制方法更高的吞吐量。

多版本并发控制（ Multiversion Concurrency Control , MVCC）并不是一个 与乐观锁和悲观锁对立的概念，它能够与两者很好地结合以增加事务的并发量。 MVCC 的每一个写操作都会创建一个新版本的数据，读操作会从有限多个版本的数据中挑选一个“最合适”（要么是最新版本，要么是指定版本）的结果直接返回 。通过这种方式，读写操作之间的冲突就不再需要受到关注。因此，如何管理和高效地选取数据的版本就成了 MVCC 需要解决的主要问题。

## Reference

